# Zabbix Interface & Host Status Monitor

**Ruby-—Å–∫—Ä–∏–ø—Ç –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ –º–µ—Ä–µ–∂–µ–≤–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ —É Zabbix —á–µ—Ä–µ–∑ SNMP.**

–í—ñ–¥—Å—Ç–µ–∂—É—î —Å—Ç–∞—Ç—É—Å —Ö–æ—Å—Ç—ñ–≤ —Ç–∞ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–≤, —Ñ—ñ–∫—Å—É—î –∑–º—ñ–Ω–∏, —Ä–æ–±–∏—Ç—å –∞–Ω–∞–ª—ñ–∑ –ø—Ä–∏ –∞–≤–∞—Ä—ñ—è—Ö —ñ —Ñ–æ—Ä–º—É—î –∑–≤–µ–¥–µ–Ω—ñ –∑–≤—ñ—Ç–∏ –Ω–∞ email.

–Ü–¥–µ–∞–ª—å–Ω–æ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è NOC-–∫–æ–º–∞–Ω–¥: –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –≤ cron –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω, –∞–∫—É–º—É–ª—é—î –ø–æ–¥—ñ—ó, –∞ —Ä–∞–∑ –Ω–∞ –¥–æ–±—É –Ω–∞–¥—Å–∏–ª–∞—î –∑–≤—ñ—Ç.

## –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ

- –ü—Ä–∞—Ü—é—î –∑ Zabbix 5.x (–ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ –Ω–∞ 5.2.0alpha1)
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ç—ñ–ª—å–∫–∏ SNMP-–¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å (`snmp_available`)
- –ó–±–µ—Ä—ñ–≥–∞—î –¥–∞–Ω—ñ –≤ –ª–æ–∫–∞–ª—å–Ω—ñ–π SQLite –ë–î (`zabbix_status.db`)
- –ê–Ω–∞–ª—ñ–∑ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–≤ —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ –ø–∞–¥—ñ–Ω–Ω—ñ —Ö–æ—Å—Ç–∞ (DOWN)
- –î–≤–∞ —Ä–µ–∂–∏–º–∏ –∞–Ω–∞–ª—ñ–∑—É: –ø–æ–≤–Ω–∏–π (–æ—Å—Ç–∞–Ω–Ω—ñ 30 –∑–º—ñ–Ω) —Ç–∞ –∫–æ–º–ø–∞–∫—Ç–Ω–∏–π (–æ—Å—Ç–∞–Ω–Ω—ñ UP/DOWN)
- –ê–∫—É–º—É–ª—è—Ü—ñ—è –ø–æ–¥—ñ–π —É —Ç–∞–±–ª–∏—Ü—ñ `event_log`
- –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –∑–≤—ñ—Ç—ñ–≤ –Ω–∞ email —á–µ—Ä–µ–∑ `/usr/bin/mail`
- –û–ø—Ü—ñ—ó `--report` (–±–µ–∑ –æ—á–∏—â–µ–Ω–Ω—è) —Ç–∞ `--report-and-flush`
- –ó–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –ø–∞—Ä–∞–ª–µ–ª—å–Ω–∏–º –∑–∞–ø—É—Å–∫–∞–º —á–µ—Ä–µ–∑ `flock` (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)

## –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

```bash
git clone https://github.com/–í–ê–®_–ù–Ü–ö/zabbix-ifstatus-monitor.git
cd zabbix-ifstatus-monitor
chmod +x z-ifstatus.rb
```

–ü–æ—Ç—Ä—ñ–±–µ–Ω Ruby 2.7+ —Ç–∞ SQLite3 (–∑–∞–∑–≤–∏—á–∞–π –≤–∂–µ —î –Ω–∞ Linux).

## –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –û—Å–Ω–æ–≤–Ω–∏–π —Ä–µ–∂–∏–º (–∫–æ–∂–Ω—ñ 5 —Ö–≤ —É cron)

```bash
./z-ifstatus.rb -u noc -p '–ø–∞—Ä–æ–ª—å' --analyze-accessibility-small
```

–ê–±–æ –∑ –ø–æ–≤–Ω–∏–º –∞–Ω–∞–ª—ñ–∑–æ–º:

```bash
./z-ifstatus.rb -u noc -p '–ø–∞—Ä–æ–ª—å' --analyze-accessibility
```

### –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –∑–≤—ñ—Ç—É (–æ–¥–∏–Ω, –∞–±–æ –¥–≤–∞ —Ä–∞–∑–∏ –Ω–∞ –¥–æ–±—É‚Ä¶ –º–æ–∂–Ω–∞ –π —á–∞—Å—Ç—ñ—à–µ, –∞–ª–µ –Ω–∞—à–æ?)

```bash
./z-ifstatus.rb --report-and-flush \
  --mail-to noc@company.com \
  --mail-from zabbix@company.com \
  --mail-replyto noc@company.com
```

–ë–µ–∑ –æ—á–∏—â–µ–Ω–Ω—è –ª–æ–≥—É:

```bash
./z-ifstatus.rb --report --mail-to noc@company.com
```

## –Ü–Ω—à—ñ –∫–æ—Ä–∏—Å–Ω—ñ –æ–ø—Ü—ñ—ó

* --show-all ‚Äî –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω –≤—Å—ñ—Ö —Ö–æ—Å—Ç—ñ–≤ —Ç–∞ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–≤
* --since 1h ‚Äî –∑–º—ñ–Ω–∏ –∑–∞ –æ—Å—Ç–∞–Ω–Ω—é –≥–æ–¥–∏–Ω—É
* --quiet ‚Äî –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π –≤–∏–≤—ñ–¥ (–¥–ª—è cron)
* --db /path/to/custom.db ‚Äî —Å–≤–æ—è –±–∞–∑–∞ –¥–∞–Ω–∏—Ö

## –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ cron –∑ flock

–°—Ç–≤–æ—Ä—ñ—Ç—å –æ–±–≥–æ—Ä—Ç–∫—É z-ifstatus.sh:

```bash
#!/bin/bash

SCRIPT_DIR="$$ (cd " $$(dirname "${BASH_SOURCE[0]}")" && pwd)"
LOCK_FILE="$SCRIPT_DIR/z-ifstatus.lock"

exec flock -x "$LOCK_FILE" \
  "$$ SCRIPT_DIR/z-ifstatus.rb" " $$@"
```

–ó—Ä–æ–±—ñ—Ç—å –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–º:

```bash
chmod +x z-ifstatus.sh
```

–î–æ–¥–∞–π—Ç–µ –≤ crontab:

```
*/5 * * * * /path/to/z-ifstatus.sh -u noc -p '–ø–∞—Ä–æ–ª—å' --analyze-accessibility-small
0 8 * * *   /path/to/z-ifstatus.sh --report-and-flush --mail-to noc@company.com --mail-from zabbix@company.com
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

* hosts ‚Äî —Å–ø–∏—Å–æ–∫ —Ö–æ—Å—Ç—ñ–≤
* host_status ‚Äî –æ—Å—Ç–∞–Ω–Ω—ñ–π —Å—Ç–∞—Ç—É—Å —Ö–æ—Å—Ç–∞
* interfaces ‚Äî —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏ —Ö–æ—Å—Ç—ñ–≤
* interface_status ‚Äî –æ—Å—Ç–∞–Ω–Ω—ñ–π —Å—Ç–∞—Ç—É—Å —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
* event_log ‚Äî –∞–∫—É–º—É–ª—è—Ç–æ—Ä –ø–æ–¥—ñ–π –¥–ª—è –∑–≤—ñ—Ç—ñ–≤

## –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–≤–æ–¥—É –ø—Ä–∏ –∞–≤–∞—Ä—ñ—ó

```
================================================================================
–ê–í–ê–†–Ü–Ø: szhil118-1 ‚Äî 2025-12-22 05:55:02
        –ß–∞—Å –±–µ–∑–∞–≤–∞—Ä—ñ–π–Ω–æ—ó —Ä–æ–±–æ—Ç–∏: 8 –≥–æ–¥–∏–Ω, 35 —Ö–≤–∏–ª–∏–Ω —Ç–∞ 1 —Å–µ–∫—É–Ω–¥–∞
        (–∑ 2025-12-21 21:20:01 –ø–æ 2025-12-22 05:55:02)
================================================================================
–ó–º—ñ–Ω–∏ –Ω–∞ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö –º—ñ–∂ –æ—Å—Ç–∞–Ω–Ω—ñ–º UP —Ç–∞ DOWN (–≤—ñ–¥ —Å–≤—ñ–∂–∏—Ö –¥–æ —Å—Ç–∞—Ä–∏—Ö):
 –ß–∞—Å –æ—Å—Ç–∞–Ω–Ω—å–æ—ó –∑–º—ñ–Ω–∏ ‚Üí –°—Ç–∞—Ç—É—Å | –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å
 -----------------------------------------------------------------------------
 2025-12-22 04:35:01 ‚Üí DOWN   | Interface 1/1(1234, MUSIKI)
 2025-12-21 23:50:02 ‚Üí UP     | Interface 1/6(5678, PUSIKI)
 (–ø–æ–∫–∞–∑–∞–Ω–æ 2 –∑–º—ñ–Ω)
--------------------------------------------------------------------------------
```

## –ë–µ–∑–ø–µ–∫–∞

* –ü–∞—Ä–æ–ª—å –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –∞–±–æ –∑–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è WHOAMI / WHATISMYPASSWD
* –†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –æ–∫—Ä–µ–º–æ–≥–æ Zabbix-–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –ø—Ä–∞–≤–∞–º–∏ —Ç—ñ–ª—å–∫–∏ –Ω–∞ —á–∏—Ç–∞–Ω–Ω—è (host.get, item.get)

## –ê–≤—Ç–æ—Ä

oldengremlin

–ó—Ä–æ–±–ª–µ–Ω–æ –∑ –ª—é–±–æ–≤'—é –¥–æ –º–µ—Ä–µ–∂ —Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó.

‚≠ê –Ø–∫—â–æ —Å–ø–æ–¥–æ–±–∞–ª–æ—Å—å ‚Äî —Å—Ç–∞–≤ –∑—ñ—Ä–æ—á–∫—É!

ü™≤ –ó–Ω–∞–π—à–æ–≤ –±–∞–≥ –∞–±–æ –º–∞—î—à —ñ–¥–µ—é ‚Äî —Å—Ç–≤–æ—Ä—é–π issue!
